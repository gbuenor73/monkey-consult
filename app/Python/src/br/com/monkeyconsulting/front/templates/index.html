<!DOCTYPE html>
<html lang="pt">
  <head>
    <title>Monkey Consulting</title>
    <meta charset="UTF-8" />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <!--     <script type="module" src="https://pyscript.net/latest/pyscript.js"></script>-->
  </head>

  <body class="body">
    <h1 class="py-title">Monkey Consulting</h1>
    <br />
    <button class="py-button" onclick="openPopup('clientes')">
      Adicionar Cliente
    </button>
    <br />
    <br />
    <table>
      <thead>
        <tr style="background-color: wheat" class="marked_row">
          <th>Nome</th>
          <th>Telefone</th>
          <th>Plano</th>
          <th>Dieta / Treino</th>
          <th>Data da Troca Plano</th>
          <th>Data de Vencimento Plano</th>
          <th>Data de Pagamento</th>
        </tr>
      </thead>
      <tbody>
        {% for cliente in dados.data %}
        <tr class="marked_row">
          <!-- <td>{{ cliente.id_cliente }}</td> -->
          <td>{{ cliente.nome }}</td>
          <td>{{ cliente.telefone }}</td>
          <td>{{ cliente.plano.descricao }}</td>
          <td>{{ cliente.dieta.descricao }}</td>
          <td>{{ cliente.proxima_troca_dieta_treino }}</td>
          <td>{{ cliente.vencimento_plano }}</td>
          <td>{{ cliente.data_pagamento }}</td>
          <td>
            <button
              id="editarCliente"
              title="Editar Cliente"
              onclick="openPopup('clientes/editar/{{ cliente.id_cliente }}')"
            >
              &#9998;
            </button>
            <button id="informarPagamento" title="Informar Pagamentos">
              $$
            </button>
            <button
              id="desativarCliente"
              title="Deletar Cliente"
              id_cliente="{{ cliente.id_cliente }}"
            >
              &#9940;
            </button>
            <button
              id="congelarCliente"
              title="Congelar Cliente"
              id_cliente="{{ cliente.id_cliente }}"
            >
              &#129482;
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <br />

    <script>
      function openPopup(url) {
        var style = "width=500, height=500, scrollbars=yes";
        window.open(url, "_blank", style);
      }
      document
        .getElementById("desativarCliente")
        .addEventListener("click", function () {
          var id_cliente = this.getAttribute("id_cliente"); 
          var confirm = window.confirm("Deletar Cliente?");

          if (confirm == true) {
            var req = new XMLHttpRequest();
            req.open("DELETE", "/clientes/" + id_cliente, true);
            req.onreadystatechange = function () {
              if (req.readyState === 4) {
                if (req.status === 200) {
                  console.log(req.responseText);
                  window.location.reload();
                }
                console.log("Erro na requisicao", req.status, req.statusText);
              }
            };
            req.send();
          }
        });
    </script>
  </body>
</html>
