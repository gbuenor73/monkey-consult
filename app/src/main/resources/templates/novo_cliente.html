<!DOCTYPE html>
<html>

<head>
  <title>Novo Cliente</title>
  <meta charset="UTF-8" />
  <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
</head>

<body>
  <h1>Editar Cliente</h1>

  <form id="novo_cliente" th:action="@{/insere}" method="POST">
    <label >Nome:</label>
    <input type="text" id="nome" name="nome" placeholder="Nome Completo" required />

    <br>
    <label >Telefone:</label>
    <input type="tel" id="telefone" name="telefone" pattern="[0-9]{11}" maxlength="11" placeholder="Apenas nÃºmeros" required/>

    <br>
    <label >Valor Bruto:</label>
    <input value="R$ 0,00" type="text" id="valor_bruto" name="valor_bruto" onkeyup="formatarMoeda(this)">

    <br>
    <label >Valor Liquido:</label>
    <input value="R$ 0,00" type="text" id="valor_liquido" name="valor_liquido" onkeyup="formatarMoeda(this)">

    <br>
    <input type="submit" onclick="enviar_formulario()" value="Enviar" />
    <button onclick="window.close()">Voltar</button>    
  </form>

  <!-- #include virtual="default/footer"-->

  <script>
    function enviar_formulario() {
      formulario = document.forms[0];
      console.log("form valor_bruto")
      console.log(formulario.valor_bruto.value)
      formulario.valor_bruto.value = formulario.valor_bruto.value.replace(/[^\d,]/g, '').replace(',','.')
      console.log("form valor_bruto formatario")
      console.log(formulario.valor_bruto.value)
      formulario.valor_liquido.value = formulario.valor_liquido.value.replace(/[^\d,]/g, '').replace(',','.')

      if (formulario.nome.value == "" || formulario.telefone.value == "") {
        alert("Ao menos os campos obrigatorios devem ser preenchidos");
        return;
      } else {
        formulario.submit();
        setTimeout(function () {
          window.opener.location.reload();
          window.close();
        }, 100);
      }
    }

    document.addEventListener("keydown", function (event) {
      if (event.key === "Escape") window.close();
    });

    function formatarMoeda(input) {
      let valor = input.value;
      valor = valor.replace(/\D/g, '');
      valor = (Number(valor) / 100).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
      input.value = valor;
    }

  </script>
</body>

</html>